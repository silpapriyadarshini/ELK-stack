name: ELK deployment in AWS
on:
  push:
    branches:
      feature
jobs:
   terraform-deploy:
      runs-on: ubuntu-latest
      permissions:
        packages: write
        contents: read
        id-token: write
      steps:
        - name: Clone our repository
          uses: actions/checkout@v3

        - name: AWS Authentication 
          uses: aws-actions/configure-aws-credentials@v1
          with:
            role-to-assume: arn:aws:iam::772377598567:role/github_actions-oidc
            aws-region: ap-southeast-2
            role-session-name: GithubELKDeploy

        - name: Terraform Set up
          uses: hashicorp/setup-terraform@v1

        - name: Terraform Initialization
          run: terraform init

        - name: Terraform planning
          run:  terraform plan -lock=false
          
        - name: Terraform applying
          run:  terraform apply -auto-approve -lock=false